<div class="hero hero--recipe">
  <div class="hero__content">
    <div class="recipe__header">
      <h1><%= @recipe.name %></h1>
    </div>
    <div class="recipe__subheader">
      <%= link_to @recipe_source.name, @recipe_source, class: "simple-link simple-link--underline" %>
      <% if @like %>
        <%= link_to "Saved", unlike_recipe_path(@recipe), class: "simple-link simple-link--underline", id: "unsave-recipe" %>
      <% else %>
        <%= link_to "Save", like_recipe_path(@recipe, redirect_url: like_recipe_path(@recipe)), class: "simple-link simple-link--underline" %>
      <% end %>
    </div>
  </div>
</div>
<div class="container container--recipe">
  <% unless @recipe.image_url.blank? %>
    <div class="recipe__image" style="background-image: url(<%= @recipe.image_url %>)"></div>
  <% end %>
  <% unless current_user %>
    <div class="recipe__subheader sign-in-cta">
      <p>Sign in to create a grocery list from this recipe.</p>
      <%= link_to "Sign In", {controller: "auth0", action: "login", redirect_url: request.original_url } %>
    </div>
  <% end %>
  <div class="recipe__content">
    <div class="recipe__actions">
      <% unless @already_added %>
        <%= link_to "Add To Grocery List", add_to_list_recipe_path(@recipe, redirect_url: add_to_list_recipe_path(@recipe)), class: "simple-link simple-link--primary" %>
      <% end %>
      <a href="<%= @recipe.link %>?utm_source=recidex.com&utm_medium=referral" class="simple-link simple-link--secondary">View Recipe</a>
      <% if current_user && @already_added %>
        <%= link_to "My Grocery List (#{@ingredient_count})", "/groceries", class: "simple-link simple-link--background" %>
        <%= link_to "Remove From Grocery List", remove_from_list_recipe_path(@meal_plan, redirect_url: remove_from_list_recipe_path(@recipe)), class: "simple-link simple-link--background" %>
      <% end %>
    </div>
    <div class="recipe__ingredients">
      <h2>Ingredients (<%= @recipe.ingredients.length %>)</h2>
      <% @recipe.ingredients.each do |ingredient| %>
        <div class="ingredient">
          <p><%= ingredient %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>
<% if @related_recipes.count > 3 %>
  <div class="container container--recipe" id="related-recipes">
    <h2>Similar Recipes</h2>
    <div class="recipe-carousel">
      <% @related_recipes.sample(10).each do |recipe| %>
        <%= render 'recipe_card_large', recipe: recipe, recipe_source: recipe.recipe_source, show_source: true %>
      <% end %>
    </div>
  </div>
<% end %>
<% if @recipe_source.recipes.count > 3 %>
  <div class="container container--recipe" id="related-recipes">
    <h2>More from <%= @recipe_source.name %></h2>
    <%= link_to "View All Recipes", @recipe_source, class: "simple-link simple-link--underline" %>
    <div class="recipe-carousel">
      <% @recipe_source.recipes.sample(10).each do |recipe| %>
        <% unless recipe == @recipe %>
          <%= render 'recipe_card_large', recipe: recipe, recipe_source: recipe.recipe_source, show_source: false %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
<% if @people_also_liked.count > 0 %>
  <div class="container container--recipe" id="related-recipes">
    <h2>People Also Liked</h2>
    <div class="recipe-carousel">
      <% @people_also_liked.each do |recipe| %>
        <% unless recipe == @recipe %>
          <%= render 'recipe_card_large', recipe: recipe, recipe_source: recipe.recipe_source, show_source: true %>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>

<script type="text/javascript">
  $('#unsave-recipe').on('mouseover', function() {
    $(this).text("Unsave")
  })

  $('#unsave-recipe').on('mouseleave', function() {
    $(this).text("Saved")
  })
</script>
